{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load humanize %}
{% block content %}

<body>
    <!-- Page content-->
    <div class="container mt-5">
        <div class="row">
            <!-- Main post content-->
            <div class="col-lg-8">
                <!-- Post content-->
                <article>
                    <!-- Post header-->
                    <header class="mb-4">
                        <!-- Post title-->
                        <h1 class="fw-bolder mb-1">{{ post.title }}</h1>
                        <br>
                        <!-- Post meta content-->
                        <div class="text-muted fst-italic mb-2">{{ post.writer }},  {{ post.date }}</div>
                    </header>
                    <!-- Preview image figure-->
                    <figure class="mb-4"><img class="img-fluid rounded" src="{{ post.picture.url }}" alt="..." /></figure>
                    <!-- Post categories-->
                    <div class="badge bg-secondary text-decoration-none link-light" > Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø·: Ø¢Ø¯Ù… Ø®Ø§Ù†Ú¯ÛŒÙ {{ post.cat_name }} </div>
                    <br><br><br>
                    <!-- Post content-->
                    <section class="mb-5">
                        <p class="fs-5 mb-4">{{ post.body }}</p>
                    </section>
                    {% if post.writer == request.user %}
                    <a class="badge bg-primary text-decoration-none link-light " href="{% url 'update_post' post.pk %}">ÙˆÛŒØ±Ø§ÛŒØ´ </a>
                    <a class="badge bg-danger text-decoration-none link-light " href="{% url 'delete_post' post.pk %}">Ø­Ø°Ù</a>
                    {% endif %}
                     


                  

                    <br><br>
                   <!-- Ø¯Ú©Ù…Ù‡ Ù„Ø§ÛŒÚ© -->
<div dir="ltr" id="like-section" data-post-id="{{ post.pk }}">
    <button id="like-btn-{{ post.pk }}"  data-post-id="{{ post.pk }}"  data-liked="{% if request.user in post.likes.all %}true{% else %}false{% endif %}" class="btn btn-outline-danger like-btn" >
        {% if request.user in post.likes.all %}
            â¤ï¸ Ù„Ø§ÛŒÚ© Ø´Ø¯Ù‡
        {% else %}
            ğŸ¤ Ù„Ø§ÛŒÚ©
        {% endif %}
    </button>
    <span id="like-count-{{ post.pk }}">{{ post.likes.count }}</span>  like
</div>


  


<br><br>
<div class="text-end mb-3">
    <a class="btn btn-outline-dark" href="{{ previous_url|default:catlog_url }}">
        Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ
    </a>
</div>


<!--HTTP_REFERER ØªÙˆØ³Ø· Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ù…Ú©Ø§Ù† Ø¯Ø³ØªÚ©Ø§Ø±ÛŒ Ø¢Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ Ù…Ø·Ù…Ø¦Ù† Ø¨ÙˆØ¯Ù†ØŒ Ù‡Ù…ÛŒØ´Ù‡ ÛŒÚ© Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ (Ù…Ø§Ù†Ù†Ø¯ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ).-->
<!--Ù¾Ø³ Ø§Ø² Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§ØªØŒ Ø¯Ø± ØµÙØ­Ù‡ Ù¾Ø³Øª ÛŒÚ© Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ù‡ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯. Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù‡ÛŒÚ† URL Ù‚Ø¨Ù„ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ÛŒØ§ Ù…Ø³ÛŒØ±ÛŒ Ú©Ù‡ Ø´Ù…Ø§ Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ù‡Ø¯Ø§ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯.-->





                    
                    <br><br><br>
                </article>

                <!-- Comment Section -->
                <div class="blog-comments">
                    {% if user.is_authenticated %}
                    <div class="card">
                        <h5 class="card-header">Ú©Ø§Ù…Ù†ØªÛŒ Ø¨Ú¯Ø°Ø§Ø± Ø§ÛŒ {{user.username }} </h5>
                        <div class="card-body">
                            <form method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="previous_url" value="{{ request.META.HTTP_REFERER }}">
                                {{ form | crispy }}
                                <br>
                                <button type="submit" class="btn btn-secondary">Ø§Ø±Ø³Ø§Ù„ Ú©Ø§Ù…Ù†Øª</button>
                            </form>
                            <br>
                        </div>
                    </div>
                    {% endif %}
                    <br>

                    {% if post.comment_set.count > 1 %}
                    <h6 class="comments-count">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-fill" viewBox="0 0 16 16">
                            <path d="M2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                          </svg> {{ post.comment_set.count }} Comments</h6>
                        
                        
                    {% else %}<h6 class="comments-count"></h6>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-fill" viewBox="0 0 16 16">
                        <path d="M2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                      </svg> {{ post.comment_set.count }} Comment</h6>
                    
                    {% endif %}

                    <!-- Comments section-->
                    <section class="mb-5">
                        <div class="card bg-light">
                            <div class="card-body">
                                <!-- Single comment-->
                                {% for comment in post.comment_set.all %}
                                <div class="d-flex">
                                    <div class="flex-shrink-0">
                                        <img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..." />
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold">{{ comment.author }}</div>
                                        <small><time dir="ltr" datetime="2020-01-01" class="text-muted fst-italic mb-2">{{ comment.date | naturaltime }}</time></small>
                                        <br>
                                        <p>{{ comment.body }}</p>
                                    </div>
                                </div>
                                <br>
                                {% endfor %}
                            </div>
                        </div>
                    </section>
                </div> <!-- End of blog-comments -->
            </div> <!-- End of main post content (col-lg-8) -->

            <!-- Side widgets-->
            <div class="col-lg-4">
                <!-- Side widget-->
                <div class="card mb-4">
                    <div class="card-body">
                     {% if post.writer == request.user %}
                        <center><a href="{% url 'author_posts' post.writer.id %}" class="btn btn-light btn-lg px-4"  role="button" >Ù¾Ø³Øª Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ù…Ù†</a> </center>
                            {% if author_profile.photo %}
                                <div class="profile-photo-container" style="text-align: center; margin-top: 10px;">
                                   <img src="{{ author_profile.photo.url }}" alt="Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„" 
                                   style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #ccc;">
                                </div>
                            {% else %}
                               <div class="profile-photo-container" style="text-align: center; margin-top: 10px;">
                                 <center> <img src="https://via.placeholder.com/150" alt=""
                                 style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #ccc;"></center>
                                </div>
                            {% endif %}



                        {% else %}
                        <center><a href="{% url 'author_posts' post.writer.id %}" class="btn btn-light btn-lg px-4"  role="button" >Ù¾Ø³Øª Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± {{ post.writer }}</a> </center>
                        {% if author_profile.photo %}
                        <div class="profile-photo-container" style="text-align: center; margin-top: 10px;">
                           <img src="{{ author_profile.photo.url }}" alt="Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„" 
                           style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #ccc;">
                        </div>
                          {% else %}
                            <div class="profile-photo-container" style="text-align: center; margin-top: 10px;">
                              <center> <img src="https://via.placeholder.com/150" alt=""
                              style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #ccc;"></center>
                            </div>
                          {% endif %}



                     {% endif %}
                    </div>
                </div>

                {% block sidebar %}
                {% include 'catlog_sidebar.html' %}
                {% endblock sidebar %}

                
            </div> <!-- End of sidebar (col-lg-4) -->
        </div> <!-- End of row -->
    </div> <!-- End of container -->
</body>


<!-- Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø±Ø§ÛŒ AJAX -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.like-btn').click(function() {
            var postId = $(this).data('post-id');
            var csrftoken = $('meta[name="csrf-token"]').attr('content'); 
    
            $.ajax({
                url: "{% url 'toggle_like' 0 %}".replace('0', postId),  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø³ÛŒØ± URL Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
                type: 'POST',
                headers: { 'X-CSRFToken': csrftoken },
                success: function(response) {
                    if (response.liked) {
                        $(`#like-btn-${postId}`).html('â¤ï¸ Ù„Ø§ÛŒÚ© Ø´Ø¯Ù‡');
                    } else {
                        $(`#like-btn-${postId}`).html('ğŸ¤ Ù„Ø§ÛŒÚ©');
                    }
                    $(`#like-count-${postId}`).text(response.like_count);
                },
                error: function(xhr, status, error) {
                    console.error("Error: ", error);
                    alert('Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯Ù‡ Ø§Ø³Øª!');
                }
            });
        });
    });
    </script>
    


{% endblock %}
